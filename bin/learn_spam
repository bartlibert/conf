#!/bin/bash

MAILDIR=~/Maildir
OPTS="--no-sync"

if [[ "$1" == "-q" ]]; then
    OPTS="$OPTS"
    PRINT=""
    OUTFILE="/dev/null"
else
    OPTS="$OPTS --showdots"
    PRINT="\n  From directory %p\n"
    OUTFILE="/dev/stdout"
fi

if [[ ! "$1" == "-q" ]]; then
    echo -n "Learning ham..."
fi
nice find $MAILDIR -type d ! -iwholename '*spam*' ! -iwholename '*sent*' ! -iwholename '*trash*' ! -iwholename '*draft*' ! -iwholename '*queue*' -name cur -printf "$PRINT" -exec sa-learn $OPTS --ham '{}' \; > $OUTFILE

if [[ ! "$1" == "-q" ]]; then
    echo -n "Learning spam..."
fi
nice find $MAILDIR -type d -iwholename '*spam*' -name cur -printf "$PRINT" -exec sa-learn $OPTS --spam '{}' \; > $OUTFILE

nice sa-learn --sync > $OUTFILE
