#!/bin/bash

export TERM='rxvt'

rec_pipe=$(mktemp -u).ttyrec
if [[ -n "$1" ]]; then
    user=$1
else
    user=$USER
fi

cleanup()
{
    rm -f $rec_pipe
}

mkfifo $rec_pipe
trap cleanup 2
trap cleanup 3
trap cleanup 15

pushd /tmp > /dev/null 2>&1
ttrtail $user > /dev/null 2>&1 &
pid=$?
popd > /dev/null 2>&1
ttyrec -a $rec_pipe

kill $pid > /dev/null 2>&1
